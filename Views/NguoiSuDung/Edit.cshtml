@model CTOM.ViewModels.EditUserViewModel

@{
    ViewData["Title"] = "Chỉnh sửa Người dùng";
}

<div class="container mt-4">
    <div class="card col-md-8 mx-auto">
        <div class="card-header bg-warning text-white">
            <h3 class="card-title fw-bold">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user-edit me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M20 6l-4 -4l-11 11a7 7 0 0 1 -10 0l-4 -4" /><path d="M4 20l-.01 0a4.7 4.7 0 0 0 6.823 3.457" /><path d="M10.086 2.097a2.2 2.2 0 0 1 2.828 0l1.094 1.094a4.7 4.7 0 0 1 -6.45 6.45" /></svg>
                @ViewData["Title"]: @Model.UserName
            </h3>
        </div>
        <div class="card-body">
            <!-- Thông báo lỗi tổng hợp -->
            <div id="validationSummary" class="mb-3" style="display: none;"></div>
            
            <form id="editUserForm" asp-action="Edit" asp-route-id="@Model.Id" method="post">
                @Html.AntiForgeryToken()
                <div asp-validation-summary="ModelOnly" class="alert alert-danger alert-important" role="alert"></div>

                <!-- Truyền Id ẩn đi -->
                <input type="hidden" asp-for="Id" id="Id" />

                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label asp-for="UserName" class="form-label"></label>
                            <input asp-for="UserName" id="UserName" class="form-control" readonly disabled />
                            <span asp-validation-for="UserName" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label asp-for="TenUser" class="form-label required"></label>
                            <input asp-for="TenUser" id="TenUser" class="form-control" 
                                   placeholder="Nhập họ và tên đầy đủ" />
                            <span asp-validation-for="TenUser" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- Thông tin phòng ban và trạng thái -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label asp-for="MaPhong" class="form-label required"></label>
                            <select asp-for="MaPhong" id="MaPhong" class="form-select" asp-items="@Model.AvailablePhongBan">
                                <option value="">--- Chọn phòng ban ---</option>
                            </select>
                            <span asp-validation-for="MaPhong" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label asp-for="TrangThai" class="form-label required"></label>
                            <select asp-for="TrangThai" id="TrangThai" class="form-select">
                                <option value="A">Active</option>
                                <option value="D">Disabled</option>
                            </select>
                            <span asp-validation-for="TrangThai" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <!-- Nhóm quyền -->
                <div class="mb-3">
                    <label class="form-label">Nhóm quyền</label>
                    <div class="border p-2 rounded">
                        @if (Model.AvailableRoles != null && Model.AvailableRoles.Any())
                        {
                            @foreach (var role in Model.AvailableRoles)
                            {
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox"
                                           name="SelectedRoleNames"
                                           value="@role.Value"
                                           id="role-@role.Value"
                                           @(Model.CurrentRoleNames.Contains(role.Value) ? "checked" : "")>
                                    <label class="form-check-label" for="role-@role.Value">
                                        @role.Text
                                    </label>
                                </div>
                            }
                        }
                        else
                        {
                            <p class="text-muted mb-0">Không có nhóm quyền nào để chọn.</p>
                        }
                    </div>
                </div>

                <!-- Nút bấm -->
                <div class="mt-4 d-flex">
                    <button type="submit" class="btn btn-primary shadow-sm">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-device-floppy me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2z" />
                            <path d="M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                            <path d="M14 4l0 4l-6 0l0 -4" />
                        </svg>
                        Lưu thay đổi
                    </button>
                    <a asp-action="Index" class="btn btn-outline-secondary ms-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-back-up me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                            <path d="M9 14l-4 -4l4 -4" />
                            <path d="M5 10h11a4 4 0 1 1 0 8h-1" />
                        </svg>
                        Quay lại danh sách
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_CoreValidationScriptsPartial" />
}
